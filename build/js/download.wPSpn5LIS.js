/*! For license information please see download.wPSpn5LIS.js.LICENSE.txt */
!function(){const e=PRHelper.getType(),t=PRHelper.getHTML(),o=PRHelper.getSetting(),l=PRHelper.getRequest(),a=PRFrontendHelper.getHTML();let r=t.getElement("#progress_bar"),s=t.getElement("#message_wrapper");const n=e=>{t.isElement(r)&&PRHelper.getHTML().addAttribute(r,{"aria-valuenow":e,style:{width:`${e}%`}})},d=()=>{n(95),l.ajax(o.getOption("ajax.get_download_links")).onSuccess((e=>{n(100),t.append(e,".downloads"),t.addClass(".downloads","show")})).onError((e=>{a.alert(s,e.message??e)})).onFinally((()=>{t.removeClass(".progress-bar","show")})).addNonce().send({file:PRHelper.getServer().getParam("file")})};let i=o.getOption("wait",0),g=PRHelper.getServer().getParam("file");if(PRHelper.getHook().on("click",(function(e,o){t.addClass(o,"disabled")}),".download-link"),i>0)if(e.isEmpty(g))a.alert(s,o.getOption("message.file_not_found"));else{const e=(e,t=1)=>Math.floor(Math.random()*(e-t)+t),o=t=>{let o,l,a={},r=Math.floor(100/t),s=r,n=1,d=i;l=e(i/(t-1)),a[0]=l;for(let g=0;g<t-2;g++)d-=l,n=s,s+=r,o=e(s,n),l=e(i/(t-1)),a[o]=l;return a[100]=d-l,a};PRHelper.getHook().on("click",(function(e,l){let a,r=0,s=o(Math.min(8,i));t.addClass(".start-download","pr-invisible"),t.addClass(".progress-bar","show");for(let e in s)a=s[e],setTimeout((()=>{100==e?d():e<95&&n(e)}),1e3*(a+r)),r+=a}),".start-download")}else d()}();