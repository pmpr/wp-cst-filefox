/*! For license information please see download.4kCgVe_L1.js.LICENSE.txt */
!function(){const e=PRHelper.getType(),t=PRHelper.getHTML(),l=PRHelper.getSetting(),r=PRHelper.getRequest(),o=PRFrontendHelper.getHTML();let a=t.getElement("#progress_bar"),s=t.getElement("#message_wrapper");const n=e=>{t.isElement(a)&&PRHelper.getHTML().addAttribute(a,{"aria-valuenow":e,style:{width:`${e}%`}})},i=()=>{n(95),r.ajax(l.getOption("ajax.get_url")).onSuccess((e=>{n(100),t.addClass(".download","show"),t.updateAttribute(".download-link",{href:e.url})})).onError((e=>{o.alert(s,e.message??e)})).onFinally((()=>{t.removeClass(".progress-bar","show")})).addNonce().send({file:PRHelper.getServer().getParam("file")})};let d=l.getOption("wait",0),g=PRHelper.getServer().getParam("file");if(PRHelper.getHook().on("click",(function(e,l){t.addClass(l,"disabled")}),".download-link"),d>0)if(e.isEmpty(g))o.alert(s,l.getOption("message.file_not_found"));else{const e=(e,t=1)=>Math.floor(Math.random()*(e-t)+t),l=t=>{let l,r,o={},a=Math.floor(100/t),s=a,n=1,i=d;r=e(d/(t-1)),o[0]=r;for(let g=0;g<t-2;g++)i-=r,n=s,s+=a,l=e(s,n),r=e(d/(t-1)),o[l]=r;return o[100]=i-r,o};PRHelper.getHook().on("click",(function(e,r){let o,a=0,s=l(Math.min(8,d));t.addClass(".start-download","pr-invisible"),t.addClass(".progress-bar","show");for(let e in s)o=s[e],setTimeout((()=>{100==e?i():e<95&&n(e)}),1e3*(o+a)),a+=o}),".start-download")}else i()}();