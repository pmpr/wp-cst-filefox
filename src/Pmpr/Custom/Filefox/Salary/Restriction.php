<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             6808e078a494b             |
    |_______________________________________|
*/
 namespace Pmpr\Custom\Filefox\Salary; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Custom\Filefox\Container; use Pmpr\Custom\Filefox\Salary\Model\PostOwner; use Pmpr\Custom\Filefox\Salary\Model\Team; use Pmpr\Module\Salary\Model\Request; use WP_Query; class Restriction extends Container { public function wigskegsqequoeks() { $this->qcsmikeggeemccuu('init', [$this, 'init'])->qcsmikeggeemccuu('save_post', [$this, 'seoeawgkwacqcqak']); $this->qcsmikeggeemccuu(Process::iuqesigcoummmkws, [$this, 'wsccmcugkouoksaa'])->qcsmikeggeemccuu(Process::okcwwauugmiisyua, [$this, 'icqoewumqkwiqiym']); } public function kgquecmsgcouyaya() { $this->cecaguuoecmccuse('posts_join', [$this, 'gqkuqskwyqkkaaee'], 10, 2)->cecaguuoecmccuse('posts_where', [$this, 'ckmoiomomseqqsqw'], 10, 2)->cecaguuoecmccuse('posts_groupby', [$this, 'caockaywiaewgism'], 10, 2); $this->cecaguuoecmccuse('user_has_cap', [$this, 'mcmiqgikusguqyeg'], 10, 3); } public function gqkuqskwyqkkaaee($eagqsqeocaokmsim, $gqgemcmoicmgaqie) { if ($this->gmsmqaoagciuigss($gqgemcmoicmgaqie)) { global $wpdb; $csqimeewkmuqaaag = PostOwner::symcgieuakksimmu()->cokoiaeeomgssqgy(); $eagqsqeocaokmsim .= " LEFT JOIN {$wpdb->prefix}{$csqimeewkmuqaaag} po ON po.post_id = {$wpdb->posts}.ID"; } return $eagqsqeocaokmsim; } public function ckmoiomomseqqsqw($icsywsyukqcciiky, $gqgemcmoicmgaqie) { if ($this->gmsmqaoagciuigss($gqgemcmoicmgaqie)) { $ycoeoaakqyskgykq = $this->uwkmaywceaaaigwo()->issssuygyewuaswa()->qyeguewwsmosqcwc(); $wgkogsmkwskskgsw = Team::symcgieuakksimmu()->coyaqyocmqmmgeew($ycoeoaakqyskgykq, Constants::gouqcwikiiygyasc); global $wpdb; if ($wgkogsmkwskskgsw) { $icsywsyukqcciiky .= " AND ({$wpdb->posts}.post_author = {$ycoeoaakqyskgykq} OR po.team_id = {$wgkogsmkwskskgsw})"; } else { $icsywsyukqcciiky .= " AND {$wpdb->posts}.post_author = {$ycoeoaakqyskgykq}"; } } return $icsywsyukqcciiky; } public function caockaywiaewgism($ewukwikemcawscwe, $gqgemcmoicmgaqie) { if ($this->gmsmqaoagciuigss($gqgemcmoicmgaqie)) { global $wpdb; $ewukwikemcawscwe = "{$wpdb->posts}.ID"; } return $ewukwikemcawscwe; } public function init() { $this->wosimcsaucumweem(); Process::symcgieuakksimmu()->ccsskqckeuaeuiek(); } public function icqoewumqkwiqiym() { $this->wsccmcugkouoksaa(); } public function wosimcsaucumweem() { $this->caokeucsksukesyo()->ekkwaykokcgqkmoi()->oeowmqwauagmkkwu('ff_roles_reloaded', 1, function () { $qqwqimmwoowakisk = ['read' => true, 'read_post' => true, 'read_posts' => true, 'upload_files' => true, 'edit_terms' => false, 'delete_terms' => false, 'moderate_comments' => true, 'edit_comment' => true, 'delete_comment' => true, 'approve_comment' => true, 'moderate_product_comments' => true, 'delete_product_comments' => true, 'edit_product_comments' => true, 'edit_post' => true, 'edit_posts' => true, 'publish_posts' => true, 'edit_published_posts' => true, 'edit_articles' => true, 'edit_published_articles' => true, 'edit_products' => true, 'edit_published_products' => true, 'delete_others_posts' => false, 'edit_others_articles' => false, 'delete_others_articles' => false, 'edit_others_products' => false, 'delete_others_products' => false]; $cymcyywycwkawmsi = [Salary::emceseoyeswkikuu => [Constants::qescuiwgsyuikume => __('Content Producer', PR__CST__FILEFOX), Constants::cecmeqwgqawkeieq => Constants::iwascisiiokuackw, Constants::mayesweykoooyugy => ['delete_post' => false, 'delete_posts' => false, 'publish_posts' => false, 'delete_published_posts' => false, 'delete_articles' => false, 'publish_articles' => false, 'delete_published_articles' => false, 'delete_products' => false, 'publish_products' => false, 'delete_published_products' => false]], Salary::icygkcucieasceuk => [Constants::qescuiwgsyuikume => __('Content Manager', PR__CST__FILEFOX), Constants::cecmeqwgqawkeieq => Constants::yaiacqocwcgmooio, Constants::mayesweykoooyugy => ['delete_post' => true, 'delete_posts' => true, 'publish_posts' => true, 'edit_others_posts' => true, 'delete_published_posts' => true, 'delete_articles' => true, 'publish_articles' => true, 'delete_published_articles' => true, 'publish_products' => true, 'delete_products' => true, 'delete_published_products' => true]]]; $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); foreach ($cymcyywycwkawmsi as $uysmeyukoeyyqamq => $uiewakwqscemywuo) { $ewgmommeawggyaek->gcegsuoqiicquosg($uysmeyukoeyyqamq); if (!$ewgmommeawggyaek->aqciiewawiwecoou($uysmeyukoeyyqamq)) { $sksmomeiauyqaomi = []; $quoueucciwmgygye = $uiewakwqscemywuo[Constants::cecmeqwgqawkeieq] ?? 0; if ($quoueucciwmgygye) { $sksmomeiauyqaomi = $ewgmommeawggyaek->aqciiewawiwecoou($uiewakwqscemywuo[Constants::cecmeqwgqawkeieq])->capabilities; } $gyskaqycyaywiiyi = array_merge($qqwqimmwoowakisk, $uiewakwqscemywuo[Constants::mayesweykoooyugy] ?? []); if ($gyskaqycyaywiiyi) { foreach ($gyskaqycyaywiiyi as $ymqmyyeuycgmigyo => $gkswkiicccswksiq) { $sksmomeiauyqaomi[$ymqmyyeuycgmigyo] = $gkswkiicccswksiq; } } $ewgmommeawggyaek->secqmksoyausymio($uysmeyukoeyyqamq, $uiewakwqscemywuo[Constants::qescuiwgsyuikume], $sksmomeiauyqaomi); } } }); } public function mcmiqgikusguqyeg($smiuugcoukoiceoq, $smgioooysaacyigy, $ywmkwiwkosakssii) { $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); $eogowigeyucaauig = $ywmkwiwkosakssii[0] ?? ''; if (empty($eogowigeyucaauig)) { return $smiuugcoukoiceoq; } if (isset($smiuugcoukoiceoq[$eogowigeyucaauig]) && $smiuugcoukoiceoq[$eogowigeyucaauig]) { return $smiuugcoukoiceoq; } $ycoeoaakqyskgykq = $ewgmommeawggyaek->qyeguewwsmosqcwc(); $yoiguusocukqeayg = $this->caokeucsksukesyo()->issssuygyewuaswa(); $uagwmwoawiwkycao = $yoiguusocukqeayg->yksywgmucwascgwk($ycoeoaakqyskgykq); if (count($uagwmwoawiwkycao) > 1) { foreach ($smgioooysaacyigy as $gkswkiicccswksiq) { if (empty($smiuugcoukoiceoq[$gkswkiicccswksiq])) { continue; } foreach ($uagwmwoawiwkycao as $oeucsuyqysaciasy) { $ccsucagoagkeoiyy = $ewgmommeawggyaek->aqciiewawiwecoou($oeucsuyqysaciasy); if ($ccsucagoagkeoiyy && !empty($ccsucagoagkeoiyy->capabilities[$gkswkiicccswksiq])) { $smiuugcoukoiceoq[$gkswkiicccswksiq] = true; break; } } } } if (isset($ywmkwiwkosakssii[2]) && in_array($eogowigeyucaauig, ['edit_post', 'delete_post', 'read_post'], true)) { $seumokooiykcomco = $this->caokeucsksukesyo()->ayueggmoqeeukqmq(); if ($post = $seumokooiykcomco->get($ywmkwiwkosakssii[2])) { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); switch ($eogowigeyucaauig) { case 'read_post': $wgkogsmkwskskgsw = Team::symcgieuakksimmu()->coyaqyocmqmmgeew($ycoeoaakqyskgykq, Constants::gouqcwikiiygyasc); if ($wgkogsmkwskskgsw > 0) { $gqgemcmoicmgaqie = $eqwoegegiamegqsm->gwumowwouoisykio([Constants::kqigmeickowqiiyy => $seumokooiykcomco->iooowgsqoyqseyuu($post), Salary::mwisuqgywiccyykw => $wgkogsmkwskskgsw]); if (PostOwner::symcgieuakksimmu()->iekyeyicoyyawomk()->exists($gqgemcmoicmgaqie)) { $smiuugcoukoiceoq[$eogowigeyucaauig] = true; } } break; case 'delete_post': case 'edit_post': $aqmwamyiwgeeymqa = null; if ($yoiguusocukqeayg->askmkgcmgekiqwsg(Salary::icygkcucieasceuk, $ycoeoaakqyskgykq)) { $aqmwamyiwgeeymqa = Request::symcgieuakksimmu()->mqosioycmusugmke($ycoeoaakqyskgykq, [$eqwoegegiamegqsm->megqywqeuquawkim(Salary::mwisuqgywiccyykw)->wegeyaguowmkqiac()]); } if ($eogowigeyucaauig !== 'delete_post' && empty($aqmwamyiwgeeymqa)) { $aqmwamyiwgeeymqa = Request::symcgieuakksimmu()->mqosioycmusugmke($ycoeoaakqyskgykq, [$eqwoegegiamegqsm->megqywqeuquawkim(Salary::mwisuqgywiccyykw)->amwwousckkqyweok()]); } if ($aqmwamyiwgeeymqa) { $smiuugcoukoiceoq[$eogowigeyucaauig] = (int) $seumokooiykcomco->mguqscccckuywsya($post) === $ycoeoaakqyskgykq || PostOwner::symcgieuakksimmu()->aiwkayseywyckasm($post, $aqmwamyiwgeeymqa); } break; } } } return $smiuugcoukoiceoq; } public function wsccmcugkouoksaa() { $oquqsamoqkequssa = PostOwner::symcgieuakksimmu(); $ceiwsaacewygcsqg = $oquqsamoqkequssa->kumuygiiqswoyasy(); $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $gqgemcmoicmgaqie = $eqwoegegiamegqsm->kyckwuuiqwmyoqma()->omaeiiwasuqkeeak($oquqsamoqkequssa->myywwqkyiwawwquy($oquqsamoqkequssa::cmiegiycgiucucgs))->omaeiiwasuqkeeak($oquqsamoqkequssa->myywwqkyiwawwquy($oquqsamoqkequssa::mwisuqgywiccyykw))->omaeiiwasuqkeeak($oquqsamoqkequssa->myywwqkyiwawwquy($ceiwsaacewygcsqg))->omaeiiwasuqkeeak('posts.ID as post_id')->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->owackeyiuiikegqg(Constants::kqigmeickowqiiyy, 'ID')->aqkyoweegqwuwsgw(Constants::qgmuskygocwmouos)->gmaouawykqgywcme())->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::uouymeyqasaeckso, $this->caokeucsksukesyo()->gscioiumssogceuc()->ciugwooasaqcywas())->gouskoeouiqwokqs()->aqkyoweegqwuwsgw(Constants::qgmuskygocwmouos))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::gikuasuikwemyqoq, Constants::iuemaweiggauysws)->aqkyoweegqwuwsgw(Constants::qgmuskygocwmouos)->maqiysyuqmwcqoig('!='))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim()->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim($ceiwsaacewygcsqg)->wegeyaguowmkqiac()->iygikqkegwkaaess())->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim($oquqsamoqkequssa::mwisuqgywiccyykw)->wegeyaguowmkqiac()->iygikqkegwkaaess())->pmouaioykaoceyag($eqwoegegiamegqsm->megqywqeuquawkim($oquqsamoqkequssa::cmiegiycgiucucgs)->wegeyaguowmkqiac()->iygikqkegwkaaess()))->wsacuksekeaemucu(20); $suuagcecoyuweoqk = $oquqsamoqkequssa->iekyeyicoyyawomk()->cieaqygkucwoqwke($gqgemcmoicmgaqie); if ($suuagcecoyuweoqk) { foreach ($suuagcecoyuweoqk as $igqsaukqcqscimok) { $this->seoeawgkwacqcqak($oquqsamoqkequssa->waecsyqmwascmqoa($igqsaukqcqscimok, Constants::kqigmeickowqiiyy, 0)); } if (count($suuagcecoyuweoqk) >= 20) { Process::symcgieuakksimmu()->uamuwgiguyaysyem(); } } } public function seoeawgkwacqcqak($gcqseksiskwueksc) { if ($gcqseksiskwueksc > 0) { $seumokooiykcomco = $this->caokeucsksukesyo()->ayueggmoqeeukqmq(); if (Constants::iuemaweiggauysws === $seumokooiykcomco->ucwmcwqmqwaymkkc($gcqseksiskwueksc) || $this->caokeucsksukesyo()->owicscwgeuqcqaig()->somkqoqeimmeemuq()) { return; } $oquqsamoqkequssa = PostOwner::symcgieuakksimmu(); $woewcmgaacwwcmyy = $oquqsamoqkequssa->iekyeyicoyyawomk()->akkkoiiymmamsauc($gcqseksiskwueksc, Constants::kqigmeickowqiiyy); $kueeocmceokoouqa = Request::symcgieuakksimmu(); $qaqgaqikqmcmukem = $seumokooiykcomco->mguqscccckuywsya($gcqseksiskwueksc); $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $aqmwamyiwgeeymqa = $kueeocmceokoouqa->iekyeyicoyyawomk()->oqomcmyuuakigusk([$eqwoegegiamegqsm->megqywqeuquawkim(Constants::meksegaoamowuwoq, $qaqgaqikqmcmukem), $eqwoegegiamegqsm->megqywqeuquawkim(Salary::mwisuqgywiccyykw)->amwwousckkqyweok(), $eqwoegegiamegqsm->megqywqeuquawkim(Salary::mwisuqgywiccyykw, '0')->maqiysyuqmwcqoig('>')]); if (empty($aqmwamyiwgeeymqa)) { return; } $wgkogsmkwskskgsw = $kueeocmceokoouqa->waecsyqmwascmqoa($aqmwamyiwgeeymqa, Salary::mwisuqgywiccyykw); $ousomaowqseoamse = $kueeocmceokoouqa->mwyqswsaeeewsosm($aqmwamyiwgeeymqa); if (empty($wgkogsmkwskskgsw) && empty($ousomaowqseoamse)) { return; } if (empty($woewcmgaacwwcmyy)) { $icwicymcioeyeyek = [Constants::kqigmeickowqiiyy => $gcqseksiskwueksc]; $icwicymcioeyeyek[Salary::mwisuqgywiccyykw] = $wgkogsmkwskskgsw; $icwicymcioeyeyek[$oquqsamoqkequssa::cmiegiycgiucucgs] = $ousomaowqseoamse; $oquqsamoqkequssa->gssiscqyqsacmeca()->gsegsiocqmsoayii($icwicymcioeyeyek); } else { $suckquwcuiuyiogc = false; $ooyigaeguummmyiw = (array) $woewcmgaacwwcmyy; $umwkocissaekoogg = (int) $oquqsamoqkequssa->waecsyqmwascmqoa($woewcmgaacwwcmyy, $oquqsamoqkequssa::mwisuqgywiccyykw); if (empty($umwkocissaekoogg) || $umwkocissaekoogg !== $wgkogsmkwskskgsw) { $ooyigaeguummmyiw[$oquqsamoqkequssa::mwisuqgywiccyykw] = $wgkogsmkwskskgsw; $suckquwcuiuyiogc = true; } $easwmoyqimwuicwe = (int) $oquqsamoqkequssa->waecsyqmwascmqoa($woewcmgaacwwcmyy, $oquqsamoqkequssa::cmiegiycgiucucgs); if (empty($easwmoyqimwuicwe) || $easwmoyqimwuicwe !== $ousomaowqseoamse) { $ooyigaeguummmyiw[$oquqsamoqkequssa::cmiegiycgiucucgs] = $ousomaowqseoamse; $suckquwcuiuyiogc = true; } if ($suckquwcuiuyiogc) { $oquqsamoqkequssa->gssiscqyqsacmeca()->gsegsiocqmsoayii($ooyigaeguummmyiw); } } } } private function gmsmqaoagciuigss($gqgemcmoicmgaqie) : bool { if ($gqgemcmoicmgaqie instanceof WP_Query && $gqgemcmoicmgaqie->is_admin && $gqgemcmoicmgaqie->is_main_query() && !$this->uwkmaywceaaaigwo()->issssuygyewuaswa()->scmcyesmmikkucie(Constants::gewmeskawiqikkoc)) { return in_array($this->caokeucsksukesyo()->skckwsgymkimyuwo()->get(Constants::uouymeyqasaeckso, [], $gqgemcmoicmgaqie), [Constants::mswoacegomcucaik, Constants::oguseymmyyoyaako, Constants::sususqikkuaoqeco, 'news'], true); } return false; } }
