<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             68d2c86223ab4             |
    |_______________________________________|
*/
 namespace Pmpr\Custom\Filefox\LoginAs; use Exception; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Custom\Filefox\Container; class LoginAs extends Container { const kkkiquyigeiogkku = 'pr_impersonation'; const imgemsuocqimykym = self::kkkiquyigeiogkku . '_token'; const oqeocysmyykaymow = self::kkkiquyigeiogkku . 'revert'; public function wigskegsqequoeks() { $this->qcsmikeggeemccuu('admin_post_' . self::kkkiquyigeiogkku, [$this, 'eaasoquqgwogqase'])->qcsmikeggeemccuu('admin_post_' . self::oqeocysmyykaymow, [$this, 'suomsqocekkksmak']); $this->qcsmikeggeemccuu('show_user_profile', [$this, 'kmqgmgssckiksias'])->qcsmikeggeemccuu('edit_user_profile', [$this, 'kmqgmgssckiksias']); $this->qcsmikeggeemccuu('admin_bar_menu', [$this, 'ekugweyyegiueigi'], 100); $this->qcsmikeggeemccuu('admin_init', [$this, 'myiygyyiigegmksc']); $this->qcsmikeggeemccuu('wp_logout', [$this, 'uwkkkwqgswckkock']); $this->waqewsckuayqguos('before_enqueue_backend_assets', [$this, 'enqueue']); } public function kgquecmsgcouyaya() { $this->cecaguuoecmccuse('user_row_actions', [$this, 'ugoecmukgkegsoke'], 10, 2); } public function mgsecsgwsmyuosas($keccaugmemegoimu, $ycoeoaakqyskgykq) { $mgegoogckgsumooq = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->aukgyiaewiccooqw(self::imgemsuocqimykym); if ($mgegoogckgsumooq && $this->uwkmaywceaaaigwo()->issssuygyewuaswa()->yciaosuiyeieceug($ycoeoaakqyskgykq, Constants::gewmeskawiqikkoc)) { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Token need to be change.', PR__CST__FILEFOX), 401); } return $keccaugmemegoimu; } private function kemgsgocwysimqau($wcysyokcaeeukqau, $ycoeoaakqyskgykq) : ?string { $kcgscimsiaeewmge = date('Y-m-d H:i:s', strtotime('+2 hours', $this->caokeucsksukesyo()->sgqicqeoumwmsmyw()->gwgmymsuwsceguce())); try { $mgegoogckgsumooq = bin2hex(random_bytes(32)); } catch (Exception $iewosgggaueeyymg) { $mgegoogckgsumooq = $this->caokeucsksukesyo()->owgcciayoweymuws()->uniqid(128); } $uowwycywwssskuys = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->ckaoiscoyuuosace(); $oigoqocygawggcow = $this->caokeucsksukesyo()->issssuygyewuaswa()->mmscegoieayuaguo(); $sogksuscggsicmac = Impersonation::symcgieuakksimmu()->gssiscqyqsacmeca()->gsegsiocqmsoayii([Constants::ioksewgkgwwikiwo => $oigoqocygawggcow, Constants::sygmkaeayiiouiwm => $mgegoogckgsumooq, Constants::yauicucwkgqyygas => $ycoeoaakqyskgykq, Constants::osmyiwigoaisauug => $uowwycywwssskuys, Impersonation::smkkgcugyukuwiuk => $wcysyokcaeeukqau, Impersonation::qqykkmcuqyuoyyyk => $kcgscimsiaeewmge]); return !is_wp_error($sogksuscggsicmac) ? $mgegoogckgsumooq : null; } private function yagemoaaakquiiwu($aokagokqyuysuksm) { Impersonation::symcgieuakksimmu()->gssiscqyqsacmeca()->sgcuwcowgwimgsgk($aokagokqyuysuksm, true); } private function ugakoeaaekwkseew(?string $mgegoogckgsumooq) { if (!is_string($mgegoogckgsumooq) || empty($mgegoogckgsumooq)) { return; } $this->caokeucsksukesyo()->giiecckwoyiawoyy()->ycasmmgsmaaumweg(self::imgemsuocqimykym, $mgegoogckgsumooq, time() + 2 * HOUR_IN_SECONDS, true); } private function simckkcsuaamwmau() { $this->caokeucsksukesyo()->giiecckwoyiawoyy()->ycasmmgsmaaumweg(self::imgemsuocqimykym, '', time() + 2 * HOUR_IN_SECONDS, true); } public function eaasoquqgwogqase() { $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); if (!$ewgmommeawggyaek->ksgkoukcicwkkaum()) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Must be logged in.', PR__CST__FILEFOX)); } $wcysyokcaeeukqau = $ewgmommeawggyaek->qyeguewwsmosqcwc(); if (!$ewgmommeawggyaek->scmcyesmmikkucie(Constants::gewmeskawiqikkoc)) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Insufficient permissions.', PR__CST__FILEFOX)); } $ycoeoaakqyskgykq = (int) $this->caokeucsksukesyo()->giiecckwoyiawoyy()->gkwaaeusmsaywikg(Constants::yauicucwkgqyygas, 0); if (!$ycoeoaakqyskgykq) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Invalid user.', PR__CST__FILEFOX)); } $gqusacuooiagkuom = $this->uwkmaywceaaaigwo()->giiecckwoyiawoyy(); if (!$gqusacuooiagkuom->ymwisceuuaiccayq(self::kkkiquyigeiogkku . $ycoeoaakqyskgykq)) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Invalid nonce.', PR__CST__FILEFOX)); } if ($ewgmommeawggyaek->yciaosuiyeieceug($ycoeoaakqyskgykq, Constants::gewmeskawiqikkoc)) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Cannot impersonate administrators.', PR__CST__FILEFOX)); } $mkucggyaiaukqoce = $ewgmommeawggyaek->woimamkkeyoyauoa(Constants::gouqcwikiiygyasc, $ycoeoaakqyskgykq); if (!$mkucggyaiaukqoce) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('User not found.', PR__CST__FILEFOX)); } $mgegoogckgsumooq = $this->kemgsgocwysimqau($wcysyokcaeeukqau, $ycoeoaakqyskgykq); $this->ugakoeaaekwkseew($mgegoogckgsumooq); $ewgmommeawggyaek->kkkuqwaqakeaykmo($ycoeoaakqyskgykq); $ewgmommeawggyaek->qsgmugaqymqgqayy($ycoeoaakqyskgykq, false, is_ssl()); $gqusacuooiagkuom->cquikcuwossiessu($gqusacuooiagkuom->acewksgasymgwmcy()); exit; } public function uwkkkwqgswckkock() { $mgegoogckgsumooq = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->aukgyiaewiccooqw(self::imgemsuocqimykym); if (empty($mgegoogckgsumooq)) { return; } $ouwuugquyeucauwu = Impersonation::symcgieuakksimmu(); $mksyucucyswaukig = $ouwuugquyeucauwu->iekyeyicoyyawomk()->akkkoiiymmamsauc($mgegoogckgsumooq, Constants::sygmkaeayiiouiwm); if (empty($mksyucucyswaukig)) { return; } $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); $ycoeoaakqyskgykq = (int) $ouwuugquyeucauwu->waecsyqmwascmqoa($mksyucucyswaukig, Constants::yauicucwkgqyygas); $wqyuyweoqgsgsmuq = $ewgmommeawggyaek->qyeguewwsmosqcwc(); if ($wqyuyweoqgsgsmuq !== $ycoeoaakqyskgykq) { return; } $wcysyokcaeeukqau = (int) $ouwuugquyeucauwu->waecsyqmwascmqoa($mksyucucyswaukig, $ouwuugquyeucauwu::smkkgcugyukuwiuk); $kyayqogcyasykiea = $ewgmommeawggyaek->woimamkkeyoyauoa(Constants::gouqcwikiiygyasc, $wcysyokcaeeukqau); if (!$kyayqogcyasykiea) { return; } $ewgmommeawggyaek->kkkuqwaqakeaykmo($wcysyokcaeeukqau); $ewgmommeawggyaek->qsgmugaqymqgqayy($wcysyokcaeeukqau, false, is_ssl()); $this->yagemoaaakquiiwu($ouwuugquyeucauwu->mwyqswsaeeewsosm($mksyucucyswaukig)); $this->simckkcsuaamwmau(); $gqusacuooiagkuom = $this->uwkmaywceaaaigwo()->giiecckwoyiawoyy(); $gqusacuooiagkuom->cquikcuwossiessu($gqusacuooiagkuom->acewksgasymgwmcy()); exit; } public function suomsqocekkksmak() { $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); if (!$ewgmommeawggyaek->ksgkoukcicwkkaum()) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Must be logged in.', PR__CST__FILEFOX)); } $mgegoogckgsumooq = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->aukgyiaewiccooqw(self::imgemsuocqimykym, ''); if (empty($mgegoogckgsumooq)) { $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('No impersonation active.', PR__CST__FILEFOX)); } $ouwuugquyeucauwu = Impersonation::symcgieuakksimmu(); $mksyucucyswaukig = $ouwuugquyeucauwu->iekyeyicoyyawomk()->akkkoiiymmamsauc($mgegoogckgsumooq, Constants::sygmkaeayiiouiwm); if (empty($mksyucucyswaukig)) { $this->simckkcsuaamwmau(); $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Invalid or expired impersonation.', PR__CST__FILEFOX)); } $cugkqygegsymsyic = $this->caokeucsksukesyo()->sgqicqeoumwmsmyw()->gwgmymsuwsceguce(false); if ($ouwuugquyeucauwu->waecsyqmwascmqoa($mksyucucyswaukig, $ouwuugquyeucauwu::qqykkmcuqyuoyyyk) < $cugkqygegsymsyic) { $this->yagemoaaakquiiwu($ouwuugquyeucauwu->mwyqswsaeeewsosm($mksyucucyswaukig)); $this->simckkcsuaamwmau(); $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Impersonation expired.', PR__CST__FILEFOX)); } $wcysyokcaeeukqau = (int) $ouwuugquyeucauwu->waecsyqmwascmqoa($mksyucucyswaukig, $ouwuugquyeucauwu::smkkgcugyukuwiuk); $kyayqogcyasykiea = $ewgmommeawggyaek->woimamkkeyoyauoa(Constants::gouqcwikiiygyasc, $wcysyokcaeeukqau); if (!$kyayqogcyasykiea) { $this->yagemoaaakquiiwu($ouwuugquyeucauwu->mwyqswsaeeewsosm($mksyucucyswaukig)); $this->simckkcsuaamwmau(); $this->caokeucsksukesyo()->euekiyuksecoccus()->die(__('Original admin account not found.', PR__CST__FILEFOX)); } $ewgmommeawggyaek->kkkuqwaqakeaykmo($wcysyokcaeeukqau); $ewgmommeawggyaek->qsgmugaqymqgqayy($wcysyokcaeeukqau, false, is_ssl()); $this->yagemoaaakquiiwu($ouwuugquyeucauwu->mwyqswsaeeewsosm($mksyucucyswaukig)); $this->simckkcsuaamwmau(); $gqusacuooiagkuom = $this->uwkmaywceaaaigwo()->giiecckwoyiawoyy(); $gqusacuooiagkuom->cquikcuwossiessu($gqusacuooiagkuom->acewksgasymgwmcy('users.php')); exit; } public function ugoecmukgkegsoke($ccowyogiqwikkkie, $mkucggyaiaukqoce) { $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); $myyymwwqgewgaqey = $ewgmommeawggyaek->immcwcemcmyosyoo(); if (!$ewgmommeawggyaek->yciaosuiyeieceug($myyymwwqgewgaqey, Constants::gewmeskawiqikkoc)) { return $ccowyogiqwikkkie; } $yoiguusocukqeayg = $this->caokeucsksukesyo()->issssuygyewuaswa(); if ($yoiguusocukqeayg->iooowgsqoyqseyuu($mkucggyaiaukqoce) === $yoiguusocukqeayg->iooowgsqoyqseyuu($myyymwwqgewgaqey)) { return $ccowyogiqwikkkie; } if ($ewgmommeawggyaek->yciaosuiyeieceug($mkucggyaiaukqoce, Constants::gewmeskawiqikkoc)) { return $ccowyogiqwikkkie; } $ycoeoaakqyskgykq = $yoiguusocukqeayg->iooowgsqoyqseyuu($mkucggyaiaukqoce); $akukmaqsqqwagwce = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->mwsmsuwkeaeymyag('admin-post.php', self::kkkiquyigeiogkku . $ycoeoaakqyskgykq, [Constants::uqgcmmosieyimiku => self::kkkiquyigeiogkku, Constants::yauicucwkgqyygas => $ycoeoaakqyskgykq]); $ccowyogiqwikkkie['login_as'] = $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->yuawgssgauywkiia(__('Login As', PR__CST__FILEFOX), $akukmaqsqqwagwce, [], sprintf('%s %s', __('Login As', PR__CST__FILEFOX), $yoiguusocukqeayg->ygwimyogyaqgumam($mkucggyaiaukqoce))); return $ccowyogiqwikkkie; } public function kmqgmgssckiksias($aeyugqwcoyuqgsau) { if (!$this->gskcawauaoiysgmq($aeyugqwcoyuqgsau)) { return; } $yoiguusocukqeayg = $this->caokeucsksukesyo()->issssuygyewuaswa(); $ycoeoaakqyskgykq = $yoiguusocukqeayg->iooowgsqoyqseyuu($aeyugqwcoyuqgsau); $akukmaqsqqwagwce = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->mwsmsuwkeaeymyag('admin-post.php', self::kkkiquyigeiogkku . $ycoeoaakqyskgykq, [Constants::uqgcmmosieyimiku => self::kkkiquyigeiogkku, Constants::yauicucwkgqyygas => $ycoeoaakqyskgykq]); $swqimwqeweekeusq = $this->caokeucsksukesyo()->wgqqgewcmcemoewo(); $swqimwqeweekeusq->sykissckqqccoiqs('h3', [], __('Administrator Tools', PR__CST__FILEFOX)); echo $swqimwqeweekeusq->yuawgssgauywkiia(__('Login as this user', PR__CST__FILEFOX), $akukmaqsqqwagwce, [], sprintf('%s %s', __('Login As', PR__CST__FILEFOX), $yoiguusocukqeayg->ygwimyogyaqgumam($aeyugqwcoyuqgsau))); } public function gskcawauaoiysgmq($mkucggyaiaukqoce) : bool { $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); $myyymwwqgewgaqey = $ewgmommeawggyaek->immcwcemcmyosyoo(); if (!$ewgmommeawggyaek->yciaosuiyeieceug($myyymwwqgewgaqey, Constants::gewmeskawiqikkoc)) { return false; } $yoiguusocukqeayg = $this->caokeucsksukesyo()->issssuygyewuaswa(); if ($yoiguusocukqeayg->iooowgsqoyqseyuu($mkucggyaiaukqoce) === $yoiguusocukqeayg->iooowgsqoyqseyuu($myyymwwqgewgaqey)) { return false; } if ($ewgmommeawggyaek->yciaosuiyeieceug($mkucggyaiaukqoce, Constants::gewmeskawiqikkoc)) { return false; } return true; } public function ekugweyyegiueigi($wpAdminBar) { $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); if (!$ewgmommeawggyaek->ksgkoukcicwkkaum()) { return; } $mgegoogckgsumooq = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->aukgyiaewiccooqw(self::imgemsuocqimykym, ''); if (empty($mgegoogckgsumooq)) { return; } $ouwuugquyeucauwu = Impersonation::symcgieuakksimmu(); $mksyucucyswaukig = $ouwuugquyeucauwu->iekyeyicoyyawomk()->akkkoiiymmamsauc($mgegoogckgsumooq, Constants::sygmkaeayiiouiwm); if (!$mksyucucyswaukig) { return; } $wqyuyweoqgsgsmuq = $ewgmommeawggyaek->qyeguewwsmosqcwc(); $ycoeoaakqyskgykq = (int) $ouwuugquyeucauwu->waecsyqmwascmqoa($mksyucucyswaukig, Constants::yauicucwkgqyygas); if ($wqyuyweoqgsgsmuq !== $ycoeoaakqyskgykq) { return; } $wcysyokcaeeukqau = (int) $ouwuugquyeucauwu->waecsyqmwascmqoa($mksyucucyswaukig, $ouwuugquyeucauwu::smkkgcugyukuwiuk); $kyayqogcyasykiea = $ewgmommeawggyaek->woimamkkeyoyauoa(Constants::gouqcwikiiygyasc, $wcysyokcaeeukqau); if (!$kyayqogcyasykiea) { return; } $yoiguusocukqeayg = $this->caokeucsksukesyo()->issssuygyewuaswa(); $ymkkoucyayqkyyao = $yoiguusocukqeayg->ygwimyogyaqgumam($kyayqogcyasykiea); $mowgokyeuymuwiew = $ewgmommeawggyaek->ogcwgigqwycqswms($wcysyokcaeeukqau, 24); $ykqiiqkcquyuoweq = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->mwsmsuwkeaeymyag('admin-post.php', self::oqeocysmyykaymow, [Constants::uqgcmmosieyimiku => self::oqeocysmyykaymow]); $ywmkwiwkosakssii = ['href' => esc_url($ykqiiqkcquyuoweq), Constants::gouqcwikiiygyasc => self::oqeocysmyykaymow, Constants::qescuiwgsyuikume => $mowgokyeuymuwiew . ' ' . $ymkkoucyayqkyyao . ' — ' . __('Return to my account', PR__CST__FILEFOX), Constants::qioguuqkouiccqig => 'top-secondary', Constants::ygeiiqckewymiueq => ['class' => 'impersonation-revert', 'title' => __('Return to original admin account', PR__CST__FILEFOX)]]; $wpAdminBar->add_node($ywmkwiwkosakssii); } public function myiygyyiigegmksc() { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); Impersonation::symcgieuakksimmu()->iekyeyicoyyawomk()->qusqeaiqgggmaskw([$eqwoegegiamegqsm->megqywqeuquawkim(Impersonation::qqykkmcuqyuoyyyk, $this->caokeucsksukesyo()->sgqicqeoumwmsmyw()->gwgmymsuwsceguce())]); } public function enqueue() { $meakksicouekcgoe = $this->caokeucsksukesyo()->usugyumcgeaaowsi(); $meakksicouekcgoe->qeqgammgesiwiysc($meakksicouekcgoe->awgyqswkqywwmkye($this, 'login-as')->awagieqcmmwkgwgs($this->iuygowkemiiwqmiw('style.css'))); } }
